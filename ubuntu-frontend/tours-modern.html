<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Tours ‚Äî Ubuntu Travels</title>
    
    <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="./assets/css/modern-theme.css">
    
    <style>
        .filters {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            border: 1px solid var(--border);
        }
        
        .filter-row {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .tour-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            display: block;
        }
        
        .tour-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .tour-card-image {
            width: 100%;
            height: 240px;
            object-fit: cover;
        }
        
        .tour-card-content {
            padding: var(--space-lg);
        }
        
        .tour-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .tour-card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }
        
        .tour-card-location {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .tour-card-meta {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-light);
        }
        
        .tour-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tour-card-price {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
        }
        
        .tour-card-price-label {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 400;
        }
        
        .empty-state {
            text-align: center;
            padding: var(--space-2xl);
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: var(--space-md);
        }
    </style>
    <link rel="stylesheet" href="./assets/css/brand-colors.css">
</head>
<body>

<!-- Topbar -->
<div class="topbar">
    <div class="topbar-content">
        <a href="./index-modern.html" class="logo">
            <svg class="logo-icon" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
            <span class="logo-text">Ubuntu Travels</span>
        </a>
        <nav class="topbar-nav">
            <a href="./index-modern.html#countries" class="topbar-link">Countries</a>
            <a href="./tours-modern.html" class="topbar-link active">Tours</a>
            <a href="./index-modern.html#about" class="topbar-link">About</a>
            <a href="./plan-trip.html" class="btn btn-primary btn-sm">Plan Your Trip</a>
            <a href="./auth.html" class="topbar-link">Sign In</a>
        </nav>
    </div>
</div>

<div class="container">
    <!-- Header -->
    <div style="margin: var(--space-xl) 0;">
        <p class="subtitle">DISCOVER</p>
        <h1 class="page-title">All Tours</h1>
        <p style="color: var(--text-muted); max-width: 600px;">
            Browse our complete collection of curated tours across East Africa
        </p>
    </div>
    
    <!-- Filters -->
    <div class="filters">
        <div class="filter-row">
            <div class="filter-group">
                <label class="form-label">Country</label>
                <select id="countryFilter" class="form-select">
                    <option value="">All Countries</option>
                    <option value="Rwanda">Rwanda</option>
                    <option value="Uganda">Uganda</option>
                    <option value="Tanzania">Tanzania</option>
                    <option value="Kenya">Kenya</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="form-label">Duration</label>
                <select id="durationFilter" class="form-select">
                    <option value="">Any Duration</option>
                    <option value="1-3">1-3 days</option>
                    <option value="4-7">4-7 days</option>
                    <option value="8+">8+ days</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="form-label">Max Price</label>
                <select id="priceFilter" class="form-select">
                    <option value="">Any Price</option>
                    <option value="500">Under $500</option>
                    <option value="1000">Under $1,000</option>
                    <option value="2000">Under $2,000</option>
                </select>
            </div>
            
            <button onclick="applyFilters()" class="btn btn-primary">Apply Filters</button>
            <button onclick="clearFilters()" class="btn btn-ghost">Clear</button>
        </div>
    </div>
    
    <!-- Results Count -->
    <div style="margin-bottom: var(--space-lg);">
        <p style="color: var(--text-muted); font-size: 14px;">
            <span id="resultsCount">Loading...</span>
        </p>
    </div>
    
    <!-- Tours Grid -->
    <div id="toursGrid" class="grid grid-3">
        <!-- Loading skeletons -->
        <div class="card skeleton" style="height: 400px;"></div>
        <div class="card skeleton" style="height: 400px;"></div>
        <div class="card skeleton" style="height: 400px;"></div>
    </div>
</div>

<script src="./assets/js/config.js"></script>
<script>
    let allTours = [];
    
    // Load tours
    async function loadTours() {
        try {
            const res = await fetch(`${API_BASE}/api/tours`);
            const data = await res.json();
            
            if (data.ok && data.tours) {
                allTours = data.tours;
                renderTours(allTours);
            } else {
                showError('Failed to load tours');
            }
        } catch (err) {
            console.error('Failed to load tours:', err);
            showError('Failed to load tours');
        }
    }
    
    // Render tours
    function renderTours(tours) {
        const grid = document.getElementById('toursGrid');
        const count = document.getElementById('resultsCount');
        
        count.textContent = `${tours.length} tour${tours.length !== 1 ? 's' : ''} found`;
        
        if (tours.length === 0) {
            grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-icon">üîç</div>
                    <h3 style="margin-bottom: var(--space-sm);">No tours found</h3>
                    <p style="color: var(--text-muted); margin-bottom: var(--space-lg);">
                        Try adjusting your filters or browse all tours
                    </p>
                    <button onclick="clearFilters()" class="btn btn-primary">Clear Filters</button>
                </div>
            `;
            return;
        }
        
        grid.innerHTML = tours.map(tour => {
            const countries = tour.countries && tour.countries.length > 0 
                ? tour.countries.join(', ') 
                : tour.location || 'Unknown';
            
            return `
                <a href="./tour-details.html?slug=${tour.slug}" class="tour-card">
                    <img src="${tour.imageUrl || ''}" alt="${tour.title}" class="tour-card-image">
                    <div class="tour-card-content">
                        <div class="tour-card-header">
                            ${tour.status === 'approved' ? '<span class="chip chip-success">Approved</span>' : ''}
                        </div>
                        <h3 class="tour-card-title">${tour.title}</h3>
                        <div class="tour-card-location">
                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>
                            </svg>
                            ${countries}
                        </div>
                        <div class="tour-card-meta">
                            <span>
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle;">
                                    <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                                </svg>
                                ${tour.durationDays} days
                            </span>
                            <span>‚≠ê ${tour.rating || 4.5}</span>
                        </div>
                        <div class="tour-card-footer">
                            <div>
                                <div class="tour-card-price">$${tour.price}</div>
                                <div class="tour-card-price-label">per person</div>
                            </div>
                            <span class="btn btn-sm btn-primary">View Details</span>
                        </div>
                    </div>
                </a>
            `;
        }).join('');
    }
    
    // Apply filters
    function applyFilters() {
        const country = document.getElementById('countryFilter').value;
        const duration = document.getElementById('durationFilter').value;
        const price = document.getElementById('priceFilter').value;
        
        let filtered = allTours;
        
        if (country) {
            filtered = filtered.filter(tour => 
                tour.countries && tour.countries.includes(country)
            );
        }
        
        if (duration) {
            const [min, max] = duration.split('-').map(d => d.replace('+', ''));
            filtered = filtered.filter(tour => {
                if (max) {
                    return tour.durationDays >= parseInt(min) && tour.durationDays <= parseInt(max);
                } else {
                    return tour.durationDays >= parseInt(min);
                }
            });
        }
        
        if (price) {
            filtered = filtered.filter(tour => tour.price <= parseInt(price));
        }
        
        renderTours(filtered);
    }
    
    // Clear filters
    function clearFilters() {
        document.getElementById('countryFilter').value = '';
        document.getElementById('durationFilter').value = '';
        document.getElementById('priceFilter').value = '';
        renderTours(allTours);
    }
    
    // Show error
    function showError(message) {
        const grid = document.getElementById('toursGrid');
        grid.innerHTML = `
            <div class="empty-state" style="grid-column: 1 / -1;">
                <div class="empty-icon">‚ö†Ô∏è</div>
                <h3 style="margin-bottom: var(--space-sm);">Error</h3>
                <p style="color: var(--text-muted); margin-bottom: var(--space-lg);">${message}</p>
                <button onclick="loadTours()" class="btn btn-primary">Try Again</button>
            </div>
        `;
    }
    
    // Initialize
    loadTours();
</script>

</body>
</html>
